var EventsMapService=function(){EventsMapService.initializeBase(this);this._timeout=0;this._userContext=null;this._succeeded=null;this._failed=null};EventsMapService.prototype={GetCachedMap:function(G,A,C,E,D,B,H){return this._invoke(EventsMapService.get_path(),"GetCachedMap",false,{flakeId:G,location:A,html:C,resetCache:E},D,B,H)},GetEvents:function(E,A,B,D,C,G){return this._invoke(EventsMapService.get_path(),"GetEvents",false,{flakeId:E,location:A,cats:B},D,C,G)},GetAllCategories:function(C,B,A,D){return this._invoke(EventsMapService.get_path(),"GetAllCategories",true,{flakeId:C},B,A,D)},GetPositionFromLocation:function(D,A,C,B,E){return this._invoke(EventsMapService.get_path(),"GetPositionFromLocation",true,{flakeId:D,location:A},C,B,E)}};EventsMapService.registerClass("EventsMapService",Sys.Net.WebServiceProxy);EventsMapService._staticInstance=new EventsMapService();EventsMapService.set_path=function(A){EventsMapService._staticInstance._path=A};EventsMapService.get_path=function(){return EventsMapService._staticInstance._path};EventsMapService.set_timeout=function(A){EventsMapService._staticInstance._timeout=A};EventsMapService.get_timeout=function(){return EventsMapService._staticInstance._timeout};EventsMapService.set_defaultUserContext=function(A){EventsMapService._staticInstance._userContext=A};EventsMapService.get_defaultUserContext=function(){return EventsMapService._staticInstance._userContext};EventsMapService.set_defaultSucceededCallback=function(A){EventsMapService._staticInstance._succeeded=A};EventsMapService.get_defaultSucceededCallback=function(){return EventsMapService._staticInstance._succeeded};EventsMapService.set_defaultFailedCallback=function(A){EventsMapService._staticInstance._failed=A};EventsMapService.get_defaultFailedCallback=function(){return EventsMapService._staticInstance._failed};EventsMapService.set_path("/flakes/EventsMap/EventsMapService.soap");EventsMapService.GetCachedMap=function(E,A,C,D,G,B,H){EventsMapService._staticInstance.GetCachedMap(E,A,C,D,G,B,H)};EventsMapService.GetEvents=function(D,A,B,E,C,G){EventsMapService._staticInstance.GetEvents(D,A,B,E,C,G)};EventsMapService.GetAllCategories=function(B,C,A,D){EventsMapService._staticInstance.GetAllCategories(B,C,A,D)};EventsMapService.GetPositionFromLocation=function(C,A,D,B,E){EventsMapService._staticInstance.GetPositionFromLocation(C,A,D,B,E)};var gtc=Sys.Net.WebServiceProxy._generateTypedConstructor;if(typeof(EventsMap_Event)==="undefined"){var EventsMap_Event=gtc("EventsMap_Event");EventsMap_Event.registerClass("EventsMap_Event")}if(typeof(EventsMap_EventCategory)==="undefined"){var EventsMap_EventCategory=gtc("EventsMap_EventCategory");EventsMap_EventCategory.registerClass("EventsMap_EventCategory")}if(typeof(EventsMap_LongLat)==="undefined"){var EventsMap_LongLat=gtc("EventsMap_LongLat");EventsMap_LongLat.registerClass("EventsMap_LongLat")}function EventsMapFlake(f){var O;var L=this;var g=f;var N="flakes/EventsMap/";var S=window.IMAGE_PREFIX+N+"images/";var d=5;var J=20;var p=20;var c=7;var m=10000;var D=5000;var B=0.005;var Z=true;var A=true;var I;var Y;var U;var P=false;var b="";var V=false;var k=false;var e=new Object();var T="";var l=[];var M;var n;var E=0;var i;var o;var C=0;var W;var a;var h;var j="";var R="";var X=5;var H=false;var Q="";var G={IS_FIRST_VISIT:0,LOCATION:1,CATEGORIES:2,PER_PAGE:3,SHOW_MAP:4,VISITED:"VISITED",SYNC:"SYNC",LOCATION_CHOICE:"LOCATION_CHOICE"};var K={EDIT_ADD_CATEGORY:'<tr class="EventsMap_Sep"></tr><tr class="EventsMap_CatRow"><td style="vertical-align:middle"><table class="EventsMap_Table" cellpadding="0" cellspacing="0"><tbody><tr><td style="text-align: left; vertical-align: middle; width: 20px; padding:0; margin:0; height:0%;"><a href="javascript:;" onclick="'+f+'.addCategoryEdit()"><img class="EventsMap_Img" src="'+S+'Add.gif" alt="Add" /></a></td><td style="text-align: left; vertical-align: middle;"><a href="javascript:;" onclick="'+f+'.addCategoryEdit()">Add category</a></td></tr></tbody></table></td></tr>',EDIT_ADD_CATEGORY_TR_TEMP:'<tr class="EventsMap_CatRow" id="#catTrID#"><td class="EventsMap_EditLCol" style="width:125px; white-space:nowrap;"> <select id="#catSelID#" style="width: 125px;">#catOp#</select>&nbsp;</td> <td style="text-align: left; vertical-align: middle;"><img alt="Delete" src="'+S+'Del.gif" onclick="#catDelID#" /></td></tr>',DEFAULT_CITY:"New York, NY, 10001, USA",DEFAULT_FLAKE_TITLE:"Local Events",FLAKE_TITLE_PREFIX:"Events in ",NO_EVENTS:"<center>We're sorry, we couldn't find any events for your location. Tip: Enter a big city that is close to you.</center>",NO_EVENTS_TOUT:"<center>Timed out while fetching event list</center>",NO_EVENTS_ERR:"<center>We're sorry, due to a temporary server problem, the events data cannot be retrieved at the moment</center>",CANT_RESOLVE_LOC:"<center>We're sorry, we couldn't find any events for your location. Tip: Enter a big city that is close to you.</center>",CANT_RESOLVE_LOC_TOUT:"<center>Timed out while resolving location</center>",XML_DOWNLOAD_ERR:"<center>Unexpected error occured while downloading Categories</center>",XML_DOWNLOAD_TOUT:"<center>Timed out while downloading Categories</center>",UP_DOWN_NAV:'<table id="'+g+'tblNav" style="height:#HIGH#" cellspacing="0" cellpadding="0" border="0" width="0%"><tr><td><a href="javascript:;" #ON_PREV#><img id="'+g+'imgPrev" border="0" src="#PIC1#" alt="Show earlier events" title="Show earlier events" /></a></td></tr><tr><td id="'+g+'tdtblNav" height="#HIGH2#">&nbsp;</td></tr><tr><td><a href="javascript:;"#ON_NEXT#><img border="0" id="'+g+'imgNext" src="#PIC2#" alt="Show later events" title="Show later events" /></a></td></tr></table>',MAP_IFRAME:'<iframe marginscrolling="no" frameborder="0" class="EventsMap_MapFrame" id="'+g+'ifr" src="flakes/EventsMap/EventsMapFrame.aspx?v=1.0&API_KEY=#API_KEY#&SITE_PREFIX='+SITE_PREFIX+'"></iframe>',FLAKE_HTML:' <div id="'+g+'divNoEvents" style="display: none"></div> <div id="'+g+'divLocationAlert" style="display: none; text-align: center; height: 25px;">Global location changed, do you want to sync? <a href="javascript:;" onclick="'+g+'.changeToGlobalLocation();">Yes</a> or <a href="javascript:;" onclick="'+g+'.noChangeOfLocation();">No</a></div>   <table cellpadding="0" cellspacing="0" width="100%">       <tbody>           <tr>               <td align="center">                   <div id="'+g+'divWaitLocating" style="display: none; vertical-align: middle; margin-bottom: 3px; text-align: center; height: 20px;">Please wait while locating events..</div>               </td>           </tr>           <tr>               <td align="center" id="'+g+'tdMapHolder">                   <div id="'+g+'divMap" style="text-align: center; border: 1px solid #000000;">                       <iframe marginscrolling="no" frameborder="0" class="EventsMap_MapFrame_Cache" id="'+g+'ifrCache" src="flakes/EventsMap/EventsMapCache.html?v=100"></iframe>                   </div>               </td>           </tr>           <tr>               <td align="center">                   <div id="'+g+'divLoading" class="downloadInProgress" style="display: none;">Loading...</div>               </td>           </tr>           <tr>               <td align="center">                   <div id="'+g+'divList">                   </div>               </td>           </tr>       </tbody>   </table>     <div id="'+g+'cache" style="display:none"></div>',FLAKE_EDIT:'   <table cellpadding="3" cellspacing="0" class="EventsMap_Table">       <tbody>           <tr>               <td class="EventsMap_EditLCol" style="vertical-align: top;">Location:</td>               <td class="EventsMap_EditRCol">                   <table cellspacing="0" cellpadding="0" border="0">                       <tbody>                           <tr>                               <td style="vertical-align: top;">                                    <input onclick="document.getElementById(\''+g+'errLoc\').style.display=\'none\'" type="radio" id="'+g+'rdoStandard" name="'+g+'locChoice" checked="checked" value="standard" />                               </td>                               <td style="vertical-align: top;">                                   <div style="padding-top: 2px; padding-bottom: 5px; padding-bottom: 10px;">                                       <label for="'+g+'rdoStandard" onclick="document.getElementById(\''+g+"errLoc').style.display='none'\">                                           My standard location<br />                                           <div id=\""+g+'divStandardLoc"></div>                                       </label>                                   </div>                               </td>                           </tr>                           <tr>                               <td style="vertical-align: top;">                                   <input type="radio" id="'+g+'rdoCustom" name="'+g+'locChoice" value="custom" />                               </td>                               <td>                                   <div style="padding-top: 2px;">                                       <label for="'+g+'rdoCustom">This location:                                        </label>                                       <input id="'+g+'txtLoc" type="text" style="width: 125px;"/>                                       <br />                                   </div>                                   <div id="'+g+'errLoc" style="padding-left: 2px; display:none; color:#ff0000">Please enter your location</div>                               </td>                           </tr>                       </tbody>                   </table>               </td>           </tr>           <tr>               <td class="EventsMap_EditLCol"></td>               <td class="EventsMap_EditRCol"></td>           </tr>           <tr class="EventsMap_Sep"></tr>           <tr>               <td class="EventsMap_EditLCol" style="vertical-align: top;">Category:</td>               <td class="EventsMap_EditRCol" style="vertical-align: top;">                   <table cellpadding="0" cellspacing="0">                       <tbody id="'+g+'catListTbody">                       </tbody>                   </table>               </td>           </tr>           <tr>               <td></td>               <td style="text-align: left; vertical-align: middle;">                   <table cellpadding="0" cellspacing="0" class="EventsMap_Table">                       <tbody>                           <tr>                               <td class="EventsMap_EditLCol"><a href="javascript:;" onclick="'+g+'.addNewAddCategoryRow()"><img style="border:0;" src="'+window.IMAGE_PREFIX+'flakes/EventsMap/images/Add.gif" alt="Add category" /></a></td>                               <td class="EventsMap_EditRCol"><a href="javascript:;" onclick="'+g+'.addNewAddCategoryRow()"> Add category</a></td>                           </tr>                       </tbody>                   </table>               </td>           </tr>           <tr class="EventsMap_Sep"></tr>           <tr>                <td class="EventsMap_EditLCol">Events per page: </td>               <td class="EventsMap_EditRCol">                   <select id="'+g+'ddlPerPage">                        <option value="2">2</option>                       <option selected="selected" value="3">3</option>                       <option value="4">4</option>                       <option value="5">5</option>                       <option value="6">6</option>                       <option value="7">7</option>                       <option value="8">8</option>                       <option value="9">9</option>                       <option value="10">10</option>                       <option value="11">11</option>                       <option value="12">12</option>                       <option value="13">13</option>                       <option value="14">14</option>                       <option value="15">15</option>                       <option value="16">16</option>                       <option value="17">17</option>                       <option value="18">18</option>                       <option value="19">19</option>                       <option value="20">20</option>                   </select>               </td>           </tr>           <tr class="EventsMap_Sep"></tr>           <tr>               <td class="EventsMap_EditLCol">Show map: </td>               <td class="EventsMap_EditRCol">                   <input id="'+g+'chkShowMap" type="checkbox" checked="false" />               </td>           </tr>           <tr class="EventsMap_Sep"></tr>           <tr>               <td></td>               <td class="EventsMap_EditRCol">                   <input type="button" class="button" value="Save" onclick="'+g+'.save()" />                   <input type="button" class="button cancel" value="Cancel" onclick="'+g+'.cancel()" />               </td>           </tr>        </tbody>   </table>'};this.load=function(q){O=q;O.setIcon(window.IMAGE_PREFIX+"flakes/EventsMap/images/LocalEventsFavicon.gif");O.body.innerHTML=K.FLAKE_HTML;O.setEditArea(K.FLAKE_EDIT);if(typeof GeoLocation!="undefined"){n=new GeoLocation($(f+"txtLoc"),false,RenderMode.TABULAR,false)}Events.OnLocationChange.add(this);e["http://localhost/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRSXBZ4ZStq4duI4CWg5yZ5ji6XcTBTNnWerR9RYNDuDykBmfVNEqZFdYw";e["http://ub.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRQlR7DvkWXSLvtsXedifbeuoYrkfRTuFkoVl_ZG339ynD37cuyJn-EjpA";e["http://beta.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRRvFZiDnHlljZPS68Y9WZm6uuj3UhS4ZjOM4KW3Vl5DnTVS4CkWTzEjnA";e["http://privatebeta.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRQXSWhffiGyqP1_xwxnhbavH7I5_BRpSmYVubt6tz5ItyB9jM3EpKAokw";e["http://demo.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRTrqPD1ykydTtkJ98Xo1StX5I--AhTr1F_UrgGK-5BFhmst8l7ZYxBx8w";e["http://www.Pageflakes.de/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRSya9mlyawI9eBhZjYQHCJha3AyzBTSVnWljEcTzsGaph5IIYkdhy5OLg";e["http://www.Pageflakes.com.br/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRTTLuWVqOxNHRSVjJkKuGvZTZGXMhTveMWk1l0ZaD74T4Pauuo2xGCJ9g";e["http://china.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRQPB3s5fyVmCPBgnXqT1yvLp3ge7RQbEM37FvJeVxhVI6q9vDKWLjY-FA";e["http://student.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRQasp0DMTZ_1b8yuNYC-t4XYDZaKBS9OQb8daKmDEKjnonh_xpU0846AA";e["http://teacher.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRTOwn620Qrad9881XrIunQn29GXHhQyf6i3aIPYw9hqyHeuY-8Jn1MkSw";e["http://india.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRRlVz6Tof2ywFL0bHzqJ0jRwMScaRQ6Hbkp4uiM4SuqlAVX2kSPJWWGUQ";e["http://www.Pageflakes.com/"]="ABQIAAAAQRbEoOgK_onvHTI1MmhZZRSxetCufSGwQOsMQUVg1x70Skkr4xTiGjVwLhf27TZN_g1rLeYrEAydDw";e["http://btzones.Pageflakes.com/"]="ABQIAAAA0a9Pn94fkFDCKSkQyY4fmhTxeDyk_xe42S0l1XJhXKMJXSAe6RSnLbT-sd3HOIF1k94Mh3JetxTSwA";e["http://www1.Pageflakes.com/"]="ABQIAAAA2hLpg1OulZUjcTbw3llLbRRDU1x0rqNd7oy2oFUCw1jwtmVVeRTcFIyWe5nzz1Iq0Z_FlXDowVlDpg";e["http://bt.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBSRXOhJ9kI2d3dnIi_CEr1e14mvchR2Cjj7z_Mfm2BYZ8776kCk0HUQxw";e["http://comcast.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBTOWsN7xoKBfsamYUjrynQO0X-DdhRWvL2lzho1c-ObN0P8MVFpMKeNjg";e["http://time.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBTD-J0RJ5-20H1vahLbPMfsjC1b7xQ8UJZMXKUyckJJpSEuFmTrcWDZqg";e["http://mysurfcanyon.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBTxFZhmmoHAvGYZ-dgiyrWj_z0aWxR3UFEc_rbtDfsXSOJvSHNvgmE_5A";e["http://bangla.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBRwXxxbNns7FqJlqHawpLCvOMcWxxStTAajsAizaeFOHJa5IiDFMaYoaw";e["http://time2007.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBSfpZmZWtKUUIScgSQDFfvwxGqBSxS-WVnQlmtQRdGTQVMTkg-ruRpfaA";e["http://food.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBRA_O4kWgyXeOZblCrIaYsQu7H2sBRtv77veWQtwKiH0Z08keT_c33uqg";e["http://sacbee.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBSKnDgvDQM-Wsjw1yG3KOsCW1SGGhRFS9S2x9cYeXxU0tkRkmU_MpM8oA";e["http://stern.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBSwSSn-jGFgbB61CJnJIHGZutRZeRR-QiyGiSYx9dKeVYOE3FvYcI4GEQ";e["http://rogers.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBTO8fkJR4gMqL5G4Nqm-Of3alu4cBSug5NqKaxvIr9DzhQ7bkOi0BnjtQ";e["http://rogers1.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBR2KAGljcZAQgFwY-NG1SJ3H-9QURRgMV3wGVnPsXiueSM_KiTBQ09IEQ";e["http://myfoxnews.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBRcBku3rDFpgP1EHWannBBeuk4PJxScUWoqCA0bmiv8sIcb5Qvlo5aNMw";e["http://chinatest.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBQjXPoSTuYEyx5eCULIZ-o0gT1CZhQ0pk12phxnvNATuu0wiNxZmU_5KQ";e["http://o2.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBQ3FPAPS1LvpfUSt7w6h1yrQxpOMBRvTERftowtkLy0Erm6sqw_mS1jMA";e["http://terra.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBQLZk69nVFtdI11DrW1_lmoGI-AUhQbvGBmh58s0ouEskzTWoPefqdzaA";e["http://itelefonica.Pageflakes.com/"]="ABQIAAAAExGhqiaQ4r8i0oi4r_Z0CBSvdK1huHDlCp1pXNY1DE3fSq4kKxRA8mAkXPSITiD4HOyda0E8Oo-2mA";e["http://knology.Pageflakes.com/"]="ABQIAAAAF7GMepzjtvnkPlDfp-LMlBSO8UOLUp9jJRu-RRr8MByawqEDBxQJw6t4dup9O0t-oyDlrRvZD4mQ8w";e["http://foxnews.Pageflakes.com/"]="ABQIAAAAODbhxnzGog18ayzMbYwJJBTcoVWfjGHQ9lwk1K6vizc5sVtNHBT64g2JKncxGBvnwF-sp544cpPn4Q";e["http://btmyoffice.Pageflakes.com/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BT3fJYRDKLsQM-8fqMerLP36SxtSBQ05wuFI44hHZU2nhM_owZt8ZS3og";e["http://www.trunkflakes.com/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BRzL3No5uzhxU42n0uiO-W5nEbCVhTo5pp-bt2PaPSaymo_tCSdpbWwaQ";e["http://www.rcflakes.com/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BTfZPX7tytsJC5kotWZLveDtdjvoBQvzpgZfiEGjvIrPo0ZOdurOtBZug";e["http://www.mirrorflakes.com/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BRvdXXxu79Xjc5FSrF6g5UCkSw1NxQHE76tFScGof4nILRxv0FaOHD2Cg";e["http://livevideo.Pageflakes.com/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BSE_sDz1kSek5Y-gZgej41MfgNFTxQgLy2Tq8rd1WhuN32ubnIkM5upjQ";e["http://lvn.Pageflakes.com/"]="ABQIAAAA6gmq_jodsMBIhQboEQNBJRSHpHbikr4i4uIFI0OEqHV5YxgfmBSV8DC42D5cXt2THUYWMt4MyVxDzw";e["http://branch.sfdev1.pageflakeshq.net/"]="ABQIAAAAu55Xp0VDzNqGJPrJlnDE9BQNPhXPmZqvyKmGLZe8oFtfZGwQfxQ6d-QijHNms_hjOFAVFWfezsWl5A";if(e[SITE_PREFIX]!=null){T=e[SITE_PREFIX]}L.cacheImages();O.dragEnd=L.dragEnded;O.enableRefresh();V=true;EventsMapService.GetAllCategories(O.internalId,F(this,this.loadCategories),F(this,this.errorLoadingCategories))};this.dragEnded=function(q,r){$(g+"divMap").innerHTML=K.MAP_IFRAME.replace("#API_KEY#",T);k=true;L.setupMap(true)};this.errorLoadingCategories=function(q){L.showError(K.XML_DOWNLOAD_ERR)};this.loadCategories=function(r){if(r!=null){o=r}else{L.showError(K.XML_DOWNLOAD_ERR);return}L.resetCatTableBody();if(App.My){Q=L.getCityString(App.My);$(g+"divStandardLoc").innerHTML="("+Q+")"}if(O.Profiles[G.IS_FIRST_VISIT]==null){if(!App.My.City){$(g+"txtLoc").value=j=K.DEFAULT_CITY;$(g+"rdoCustom").checked="True";$(g+"divStandardLoc").innerHTML=""}if(O.url.indexOf("useLocation=true")>-1){for(var q=0;q<App.My.Interests.length;++q){L.matchAndAddCat(App.My.Interests[q].trim())}}if(O.url.indexOf("useLocation=true")>-1){var s=App.My.SpecificInterests.split(",");for(var q=0;q<s.length;++q){L.matchAndAddCat(s[q].trim())}}if(L.getSelectedCategories().length==0){L.addNewAddCategoryRow()}L.saveProfile()}else{L.loadProfile()}};this.loadCachedMap=function(q){b=q;if(b!=""){L.showCachedMap()}else{V=false}};this.errorLoadCachedMap=function(q){b=""};this.refresh=function(){L.invokeEventFetchProcess()};this.invokeEventFetchProcess=function(){E=0;Z=true;if(V==true){EventsMapService.GetCachedMap(O.internalId,j,"",false,F(this,this.loadCachedMap),F(this,this.errorLoadCachedMap))}EventsMapService.GetPositionFromLocation(O.internalId,j,F(this,this.onLoadGeocode),F(this,this.onGetPositionError))};this.onEvent=function(q,r){Q=L.getCityString(App.My);$(g+"divStandardLoc").innerHTML="("+Q+")";if(q=="OnLocationChange"&&r!=j&&$(g+"rdoStandard").checked){L.changeToGlobalLocation()}};this.getCityString=function(r){var q=r.City;if(r.ZipCode){q+=", "+r.State+", "+r.ZipCode}q+=", "+r.Country;return q};this.changeToGlobalLocation=function(){O.Profiles[G.SYNC]=1;O.Profiles[G.LOCATION_CHOICE]="0";O.save();L.saveProfile();$nodisplay(g+"divLocationAlert");$display($(g+"tdMapHolder"))};this.onGetPositionError=function(q){cityCountry=j.split(",");if(Z==true&&cityCountry.length>2){j=cityCountry[0]+", "+cityCountry[2];EventsMapService.GetPositionFromLocation(O.internalId,j,F(this,this.onLoadGeocode),F(this,this.onGetPositionError))}else{if(P==true){O.Profiles[G.LOCATION]=j=$(g+"txtLoc").value=K.DEFAULT_CITY;L.saveProfile()}else{L.showError(K.CANT_RESOLVE_LOC)}}Z=false};this.onLoadGeocode=function(q){if(q==undefined){L.showError(K.CANT_RESOLVE_LOC);return}W=q.Long;a=q.Lat;L.LoadEventsFromServer()};this.LoadEventsFromServer=function(){$display($(g+"divLoading"));$display($(g+"divWaitLocating"));EventsMapService.GetEvents(O.internalId,j,R,F(this,this.onLoadEvents),F(this,this.onLoadEventsError))};this.onLoadEvents=function(r){h=r;if(h.length>0){L.clearError();for(var q=0;q<h.length;++q){while(L.isBalloonAlreadyLocated(q)){L.deviateBalloon(q)}}if($(g+"chkShowMap").checked==true){if(V==true){V=false;setTimeout(g+".processMap(true)",m)}else{L.processMap(true)}}else{$nodisplay($(g+"divMap"));$nodisplay($(g+"divWaitLocating"))}L.setupList()}else{L.processMap(false)}};this.showCachedMap=function(q){$(g+"tdMapHolder").style.border="1px solid #000";if($(g+"ifrCache")){$(g+"ifrCache").contentWindow.document.getElementById("map2").innerHTML=b}L.setMapFrameHeightCached();L.setMapDivHeightCached()};this.processMap=function(q){if(V==true&&b==""){V=false;L.processMap(q);return}if(k==false){$(g+"divMap").innerHTML=K.MAP_IFRAME.replace("#API_KEY#",T);k=true}if(q==true){L.setupMap(true)}else{L.showNoEvents()}};this.showNoEvents=function(){$nodisplay($(g+"divLoading"));$nodisplay($(g+"divWaitLocating"));L.registerCheckMapFrame(true);$(g+"divList").innerHTML='<br />No local events at this time. Click <a style="color: blue; text-decoration: underline; cursor: pointer;" onclick="$module(\''+g+"').toggleEdit(); $('"+g+"txtLoc').select();\">here</a> to change city.<br /><br />"};this.onLoadEventsError=function(q){if(A==true){L.invokeEventFetchProcess();A=false}else{L.showError(K.NO_EVENTS_ERR)}};this.showError=function(q){$(g+"divNoEvents").innerHTML=q;$display($(g+"divNoEvents"));$nodisplay($(g+"divMap"));$nodisplay($(g+"divList"));$nodisplay($(g+"divLoading"));$nodisplay($(g+"divWaitLoading"))};this.clearError=function(){$nodisplay($(g+"divNoEvents"));$display($(g+"divMap"));$display($(g+"divList"))};this.cacheImages=function(){_cacheDiv=$(g+"cache");var r=$$("img");r.src=S+"shadow50.png";_cacheDiv.appendChild(r);var q=$$("img");q.src=S+"Up.png";_cacheDiv.appendChild(q);var u=$$("img");u.src=S+"Up_dis.png";_cacheDiv.appendChild(u);var t=$$("img");t.src=S+"Down.png";_cacheDiv.appendChild(t);var s=$$("img");s.src=S+"Down_dis.png";_cacheDiv.appendChild(s)};this.setupMap=function(){for(var t=0;t<X;++t){var s=(X*E)+1+t;var r=$$("img");r.src=S+s+"_map.gif";_cacheDiv.appendChild(r)}for(var t=0;t<X;++t){var s=(X*(E+1))+1+t;var r=$$("img");r.src=S+s+"_map.gif";_cacheDiv.appendChild(r)}L.registerCheckMapFrame()};this.loadCachedCity=function(q){b=q};this.errorLoadingCachedCity=function(){b=""};this.cacheCity=function(){EventsMapService.GetCachedMap(O.internalId,j,$(g+"ifr").contentWindow.document.getElementById("map2").innerHTML,false,F(this,this.loadCachedCity),F(this,this.errorLoadingCachedCity))};this.cacheCityNplotBallons=function(){if(h==null){return}L.cacheCity();var q=0;q=X*E;if(h.length>0){if(h.length!=1){L.adjustBalloonLocation()}else{$(g+"ifr").contentWindow.setLocation(h[q].Lat,h[q].Long,h[q].Name,q,false)}q=X*E;$(g+"ifr").contentWindow.setLocation(h[X*E].Lat,h[X*E].Long,h[X*E].Name,q,true);if(Browser.isIE6){$fixTable()}}$nodisplay(g+"divWaitLocating");$nodisplay($(g+"divLoading"));$(g+"tdMapHolder").style.border=""};this.adjustBalloonLocation=function(){var q=0;for(var r=0;r<X&&q<(h.length-1);++r){q=r+X*E;$(g+"ifr").contentWindow.setLocation(h[q].Lat,h[q].Long,h[q].Name,q,false)}};this.deviateBalloon=function(r){var q=Math.floor(Math.random()*4);if(q==0){h[r].Lat=parseFloat(h[r].Lat)-B}if(q==1){h[r].Lat=parseFloat(h[r].Lat)+B}if(q==2){h[r].Long=parseFloat(h[r].Long)+B}if(q==3){h[r].Long=parseFloat(h[r].Long)-B}};this.isBalloonAlreadyLocated=function(s){var r=false;for(var q=0;q<h.length;++q){if(h[q].Lat==h[s].Lat&&h[s].Long==h[q].Long&&s!=q){r=true;break}}return r};this.plotOnMap=function(){L.setMapFrameHeight();L.setMapDivHeight();$(g+"ifr").contentWindow.setCenter(a,W);$(g+"ifr").contentWindow.clearBallons();if(h!=null&&h.length>=0){$(g+"ifr").contentWindow.setLocation(a,W,"",0,true)}setTimeout(g+".cacheCityNplotBallons()",(b==""?D:1000))};this.registerCheckMapFrame=function(){var q=$(g+"ifr").contentWindow;if(Browser.isSafari){setTimeout(g+".plotOnMap()",5000);return}else{if(ie){if($(g+"ifr").readyState=="complete"){L.plotOnMap()}else{setTimeout(g+".registerCheckMapFrame()",2000)}}else{if(typeof(q.isLoaded)=="function"&&q.isLoaded()==true){L.plotOnMap()}else{setTimeout(g+".registerCheckMapFrame()",2000)}}}};this.stripWords=function(r,s){var v=r;var u=v.split(" ");if(u.length>s){var t=r.length;for(var q=0;q<s;++q){t=v.indexOf(" ");if(t==-1){break}v=v.substr(t+1,r.length-t-1)}return r.substr(0,r.length-v.length-1)+"..."}return r};this.setupList=function(){$(g+"divList").innerHTML="";var Aa=$$("table");var s=$$("tbody");var Af=$$("tr");var Ab=$$("td");var Ae=$$("td");Af.id=g+"trListMain";Aa.className="EventsMap_Table";Ab.className="EventsMap_NavMidCol";Ab.style.width="100%";Ae.className="EventsMap_NavMidRow";var t=$$("table");t.id=g+"tblEvents";t.className="EventsMap_Table";var w=$$("tbody");for(var x=0;x<X;++x){var q=x+X*E;if(q>=h.length){break}var y=$$("tr");y.className="EventsMap_CatRow";var z=$$("td");var u=$$("div");u.className="EventsMap_NumDiv";u.innerHTML=(q+1);z.appendChild(u);z.className="EventsMap_EditLCol";y.appendChild(z);var v=$$("td");var Ac=$$("span");v.className="EventsMap_EditRCol";if(h[q].Url!=""){Ac.innerHTML='<a target="_blank" href="'+h[q].Url+'">'+L.stripWords(h[q].Name,d)+"</a>"}else{Ac.innerHTML=L.stripWords(h[q].Name,d)}if(h[q].Desc!=""){TooltipManager.setTooltip(Ac,L.stripWords(h[q].Desc,J),"0:0:03")}Ac.innerHTML+=' <span style="font-size:7pt; color:#999999;">'+h[q].StartTime+"</span>";v.appendChild(Ac);v.className="EventsMap_EditRCol";y.appendChild(v);w.appendChild(y)}t.appendChild(w);Ab.appendChild(t);Af.appendChild(Ab);s.appendChild(Af);Aa.appendChild(s);$(g+"divList").appendChild(Aa);var Ad="";if(E==0){Ad=K.UP_DOWN_NAV.replace("#PIC1#",S+"Up_dis.png").replace("#ON_PREV#","")}else{Ad=K.UP_DOWN_NAV.replace("#PIC1#",S+"Up.png").replace("#ON_PREV#",'onclick="'+g+'.prev()" ')}if((E+1)*X<h.length){Ad=Ad.replace("#PIC2#",S+"Down.png").replace("#ON_NEXT#",' onclick="'+g+'.next()" ')}else{Ad=Ad.replace("#PIC2#",S+"Down_dis.png").replace("#ON_NEXT#","")}$display(g+"divList");L.setupNav(Ad,Ae);var Ag=$(g+"imgPrev");if(E==0){Ag.alt=Ag.title=""}else{Ag.alt=Ag.title="Show earlier events"}var r=$(g+"imgNext");if((E+1)*X<h.length){r.title=r.alt="Show later events"}else{r.title=r.alt=""}if(H!=true){$nodisplay($(g+"divLoading"))}};this.setupNav=function(q,r){q=q.replace("#HIGH#",$(g+"tblEvents").offsetHeight+"px").replace("#HIGH2#",($(g+"tblEvents").offsetHeight-52)+"px");r.innerHTML=q;$(g+"trListMain").appendChild(r)};this.next=function(){if(E*X<h.length){E++}L.onLoadEvents(h)};this.prev=function(){E=(E==0)?0:E-1;L.onLoadEvents(h)};this.getSelectedCategories=function(){var r=[];i=$(g+"catListTbody").getElementsByTagName("select");for(var q=0;q<i.length;++q){r.push(i[q].value)}return r};this.isAlreadySelected=function(s){var r=L.getSelectedCategories();for(var q=0;q<r.length;++q){if(r[q]==s){return true}}return false};this.doesMatchWithAnyCat=function(r){for(var q=0;q<o.length;++q){if(o[q].Name.toUpperCase().indexOf(r.toUpperCase())>=0&&r!=""&&r!=" "){return q}}return -1};this.matchAndAddCat=function(r){var q=L.doesMatchWithAnyCat(r.trim());if(q>=0&&L.isAlreadySelected(q)==false){L.addNewAddCategoryRow();$(g+"sel"+C).value=q}};this.getCategoryList=function(){var s="";var q=$(g+"catListTbody").getElementsByTagName("select");for(var r=0;r<q.length;++r){s+="<b>"+o[q[r].value].Name+"</b>,"}return s.substring(0,s.length-1)};this.cancel=function(){O.toggleEdit()};this.save=function(){P=false;if(L.saveProfile()==true){O.toggleEdit();n.forceEnter();n.parseLocation()}};this.saveProfile=function(){if($(g+"rdoCustom").checked&&$(g+"txtLoc").value==""){$display($(g+"errLoc"));return false}else{$nodisplay($(g+"errLoc"))}var r="";var s=L.getSelectedCategories();for(var q=0;q<s.length;++q){r+=s[q]+","}r=r.substring(0,r.length-1);O.Profiles[G.LOCATION]=j=$(g+"txtLoc").value;if($(g+"rdoStandard").checked){j=Q;O.Profiles[G.LOCATION_CHOICE]="0"}else{O.Profiles[G.LOCATION_CHOICE]="1"}O.setTitle(K.FLAKE_TITLE_PREFIX+j);O.Profiles[G.CATEGORIES]=R=r;O.Profiles[G.PER_PAGE]=X=$(g+"ddlPerPage").value;O.Profiles[G.SHOW_MAP]=H=$(g+"chkShowMap").checked;O.Profiles[G.IS_FIRST_VISIT]=G.VISITED;O.save();L.invokeEventFetchProcess();return true};this.loadProfile=function(){Q=L.getCityString(App.My);$(g+"divStandardLoc").innerHTML="("+Q+")";if(O.Profiles[G.CATEGORIES]!=null){R=O.Profiles[G.CATEGORIES];var q=R.split(",");L.resetCatTableBody();for(var r=0;r<q.length;++r){L.addNewAddCategoryRow();$(g+"sel"+(C)).value=q[r]}}if(O.Profiles[G.PER_PAGE]!=null){$(g+"ddlPerPage").value=X=O.Profiles[G.PER_PAGE]}if(O.Profiles[G.SHOW_MAP]!=null){H=O.Profiles[G.SHOW_MAP];$(g+"chkShowMap").checked=(H=="True")?"checked":""}if(O.Profiles[G.LOCATION]!=null){$(g+"txtLoc").value=j=O.Profiles[G.LOCATION];if(O.Profiles[G.LOCATION_CHOICE]!=null){if(O.Profiles[G.LOCATION_CHOICE]==0){$(g+"rdoStandard").checked="True";j=Q}else{$(g+"rdoCustom").checked="True"}}O.setTitle(K.FLAKE_TITLE_PREFIX+j);P=false}else{O.setTitle(K.DEFAULT_FLAKE_TITLE)}L.invokeEventFetchProcess()};this.setMapDivHeightCached=function(){var q=window.screen.availWidth;if($(g+"ifrCache")==null){return}if(q<1024){$(g+"ifrCache").contentWindow.document.getElementById("map2").style.height="130px"}else{if(q==1024){$(g+"ifrCache").contentWindow.document.getElementById("map2").style.height="180px"}else{if(q==1280){$(g+"ifrCache").contentWindow.document.getElementById("map2").style.height="220px"}else{if(q>=1600){$(g+"ifrCache").contentWindow.document.getElementById("map2").style.height="300px"}}}}};this.setMapFrameHeightCached=function(){var r=$(g+"ifrCache");if(r==null){return}var q=window.screen.availWidth;if(q<1024){r.style.height="130px"}else{if(q==1024){r.style.height="180px"}else{if(q==1280){r.style.height="220px"}else{if(q>=1600){r.style.height="300px"}}}}};this.setMapDivHeight=function(){var q=window.screen.availWidth;if(q<1024){$(g+"ifr").contentWindow.setMapHeight("130px")}else{if(q==1024){$(g+"ifr").contentWindow.setMapHeight("180px")}else{if(q==1280){$(g+"ifr").contentWindow.setMapHeight("220px")}else{if(q>=1600){$(g+"ifr").contentWindow.setMapHeight("300px")}}}}};this.setMapFrameHeight=function(){var r=$(g+"ifr");var q=window.screen.availWidth;if(q<1024){r.style.height="130px"}else{if(q==1024){r.style.height="180px"}else{if(q==1280){r.style.height="220px"}else{if(q>=1600){r.style.height="300px"}}}}};this.resetCatTableBody=function(){for(var q=0;q<$(g+"catListTbody").length;++q){$(g+"catListTbody").remove(q)}C=0};this.addNewAddCategoryRow=function(){if(C>=c){return}C++;var r=$$("tr");r.id=g+"catTr"+C;r.className="EventsMap_CatRow";var t=$$("td");var q=$$("select");q.id=g+"sel"+C;L.fillCategories(q);t.appendChild(q);r.appendChild(t);var s=$$("td");s.id=g+"tdDelImage"+C;s.setAttribute("style","text-align: left; vertical-align: middle");s.innerHTML='<a href="javascript:;" onclick="'+g+".delCatRow("+C+')">&nbsp;<img alt="Delete category" src="'+S+'Del.gif" style="border:0;" /></a>';r.appendChild(s);$(g+"catListTbody").appendChild(r);L.decideDelButton()};this.fillCategories=function(q){for(var s=0;s<o.length;++s){if(L.isAlreadySelected(o[s].ID)){continue}var r=$$("option");r.setAttribute("value",o[s].ID);r.appendChild(document.createTextNode(o[s].Name));q.appendChild(r)}};this.delCatRow=function(q){if(C-1==0){return}$(g+"catListTbody").removeChild($(g+"catTr"+q));--C;L.decideDelButton()};this.decideDelButton=function(){var r=$(g+"catListTbody").getElementsByTagName("select");var q=r[0].id;q=q.substring(q.indexOf("sel")+3);if(r.length==1){$nodisplay($(g+"tdDelImage"+q))}else{$display($(g+"tdDelImage"+q))}}};