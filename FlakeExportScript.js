var COMPACT_FRAMEWORK_FLAKE_PAGE_URL=SITE_PREFIX+"SingleFlake.aspx";var COMPACT_FRAMEWORK_FLAKE_JS_URL=SITE_PREFIX+"CFFlakeManager.js";var FLAKE_EXPORT_PREFIX="_FLAKE_EXPORT_";var FLAKE_EXPORT_PREVIEW_DIV=FLAKE_EXPORT_PREFIX+"divPreview";var FLAKE_EXPORT_WIDTH_TEXT_BOX=FLAKE_EXPORT_PREFIX+"txtWidth";var FLAKE_EXPORT_WIDTH_SPAN=FLAKE_EXPORT_PREFIX+"spnWidthError";var FLAKE_EXPORT_HEIGHT_TEXT_BOX=FLAKE_EXPORT_PREFIX+"txtHeight";var FLAKE_EXPORT_HEIGHT_SPAN=FLAKE_EXPORT_PREFIX+"spnHeightError";var FLAKE_EXPORT_AUTO_SIZE_CHECK_BOX=FLAKE_EXPORT_PREFIX+"chkAutosize";var FLAKE_EXPORT_BORDER_NONE_RADIO_BUTTON=FLAKE_EXPORT_PREFIX+"rdoBorderNone";var FLAKE_EXPORT_BORDER_SOLID_RADIO_BUTTON=FLAKE_EXPORT_PREFIX+"rdoBorderSolid";var FLAKE_EXPORT_CODE_TEXT_BOX=FLAKE_EXPORT_PREFIX+"txtCode";var FLAKE_EXPORT_CLOSE_BUTTON=FLAKE_EXPORT_PREFIX+"btnClose";var FLAKE_EXPORT_CANCEL_BUTTON=FLAKE_EXPORT_PREFIX+"btnCancel";var FLAKE_EXPORT_SETINGSCONTAINER="SettingsContainer";var FlakeExport={previewContainer:null,previewFrame:null,widthTextBox:null,widthErrorSpan:null,heightTextBox:null,heightErrorSpan:null,autosizeCheckbox:null,borderNoneRadioButton:null,borderSolidRadioButton:null,codeTextBox:null,closeButton:null,copyTextButton:null,previewResizeTimerId:null,centerDialogTimerId:null,SettingsContainer:null,init:function(){if($(FLAKE_EXPORT_POPUP_ID)==null){return}FlakeExport.previewContainer=$(FLAKE_EXPORT_PREVIEW_DIV);FlakeExport.widthTextBox=$(FLAKE_EXPORT_WIDTH_TEXT_BOX);FlakeExport.widthErrorSpan=$(FLAKE_EXPORT_WIDTH_SPAN);FlakeExport.heightTextBox=$(FLAKE_EXPORT_HEIGHT_TEXT_BOX);FlakeExport.heightErrorSpan=$(FLAKE_EXPORT_HEIGHT_SPAN);FlakeExport.autosizeCheckbox=$(FLAKE_EXPORT_AUTO_SIZE_CHECK_BOX);FlakeExport.borderNoneRadioButton=$(FLAKE_EXPORT_BORDER_NONE_RADIO_BUTTON);FlakeExport.borderSolidRadioButton=$(FLAKE_EXPORT_BORDER_SOLID_RADIO_BUTTON);FlakeExport.codeTextBox=$(FLAKE_EXPORT_CODE_TEXT_BOX);FlakeExport.SettingsContainer=$(FLAKE_EXPORT_SETINGSCONTAINER);if(Browser.isIE){FlakeExport.closeButton=$(FLAKE_EXPORT_CANCEL_BUTTON);FlakeExport.copyTextButton=$(FLAKE_EXPORT_CLOSE_BUTTON);FlakeExport.copyTextButton.value="Copy snippet";FlakeExport.copyTextButton.onclick=function(){var B=FlakeExport.codeTextBox.createTextRange();B.execCommand("Copy")}}else{FlakeExport.closeButton=$(FLAKE_EXPORT_CLOSE_BUTTON)}FlakeExport.widthTextBox.onblur=function(B){if(FlakeExport.isValid()){FlakeExport.update()}};FlakeExport.heightTextBox.onblur=function(B){if(FlakeExport.isValid()){FlakeExport.update()}};FlakeExport.autosizeCheckbox.onclick=function(B){if(FlakeExport.autosizeCheckbox.checked){FlakeExport.widthTextBox.disabled=true;FlakeExport.heightTextBox.disabled=true;FlakeExport.autoSizePreview();FlakeExport.setPreviewResizeTimer()}else{FlakeExport.widthTextBox.disabled=false;FlakeExport.heightTextBox.disabled=false;FlakeExport.clearPreviewResizeTimer()}FlakeExport.update()};FlakeExport.borderNoneRadioButton.onclick=function(B){if(FlakeExport.isValid()){FlakeExport.update()}};FlakeExport.borderSolidRadioButton.onclick=function(B){if(FlakeExport.isValid()){FlakeExport.update()}};FlakeExport.codeTextBox.onclick=function(B){FlakeExport.update();FlakeExport.codeTextBox.select()};FlakeExport.closeButton.onclick=function(B){FlakeExport.clearPreviewResizeTimer();FlakeExport.clearCenterDialogTimer();App.hideFlakeExport()};var A=FLAKE_EXPORT_PREFIX+"ifrPreview";if(FlakeExport.previewFrame==null){FlakeExport.previewContainer.innerHTML=FlakeExport.getGenerateHtml(A);FlakeExport.previewFrame=$(A)}else{FlakeExport.previewFrame.src=FlakeExport.getFlakeUrl(true)}FlakeExport.widthTextBox.value="320";FlakeExport.heightTextBox.value="260";FlakeExport.heightTextBox.disabled=true;FlakeExport.widthTextBox.disabled=true;FlakeExport.autosizeCheckbox.checked=true;$hide(FlakeExport.widthErrorSpan);$hide(FlakeExport.heightErrorSpan);FlakeExport.borderSolidRadioButton.checked=false;FlakeExport.borderNoneRadioButton.checked=true;FlakeExport.update()},getFlakeUrl:function(A){var B="";if(A){B="&MODE=gallery"}return COMPACT_FRAMEWORK_FLAKE_PAGE_URL+"?FlakeId="+App.ExportingFlakeInstanceId.toString()+B},getGenerateHtml:function(){var C=FlakeExport.getFlakeUrl(false);var B="none";if(FlakeExport.borderSolidRadioButton.checked){B="solid"}var E;var A=FlakeExport.widthTextBox.value;var G=FlakeExport.heightTextBox.value;var D=IMAGE_PREFIX+"pfback.gif";if(arguments.length>0){C+="&MODE=gallery";E='<iframe allowtransparency="true" id="'+arguments[0]+'" scrolling="no" frameborder="0" hidefocus="true" src="'+C+'" style="border:'+B+" 0px #cccccc;margin:0px;width:"+A+"px;height:"+G+'px" onload="FlakeExport.resizePreview()"></iframe>'}else{E='<script type="text/javascript" src="'+COMPACT_FRAMEWORK_FLAKE_JS_URL+'"><\/script>';var F="pffid"+App.ExportingFlakeInstanceId.toString();E+='<iframe allowtransparency="true" id="'+F+'" scrolling="no" frameborder="0" hidefocus="true" src="'+C+'" style="border:'+B+" 0px #cccccc;margin:0px;width:"+A+"px;height:"+G+'px" onload="if (typeof registerFlake == \'function\') {registerFlake(this);}"></iframe>'}return E},autoSizePreview:function(){var B=320;var A=FlakeExport.getPreviewHeight()+(Browser.isIE?7:2);FlakeExport.widthTextBox.value=B.toString();FlakeExport.heightTextBox.value=A.toString();FlakeExport.previewFrame.style.width=FlakeExport.widthTextBox.value+"px";FlakeExport.previewFrame.style.height=FlakeExport.heightTextBox.value+"px"},resizePreview:function(){FlakeExport.clearCenterDialogTimer();var A=0;var C=0;FlakeExport.centerDialogTimerId=window.setInterval(function(){if(A<=C){var D=$(FLAKE_EXPORT_POPUP_ID);if(D&&$isVisible(D)){PU.centerDiv(D)}}if(C==0){FlakeExport.update()}A=FlakeExport.SettingsContainer.clientHeight;C=document.documentElement.clientHeight-20},500);var B=$(FLAKE_EXPORT_POPUP_ID);if(B&&$isVisible(B)){PU.centerDiv(B)}$visible($(FLAKE_EXPORT_POPUP_ID));FlakeExport.autoSizePreview();FlakeExport.setPreviewResizeTimer()},setPreviewResizeTimer:function(){FlakeExport.clearPreviewResizeTimer();FlakeExport.previewResizeTimerId=window.setInterval(FlakeExport.autoSizePreview,300)},clearPreviewResizeTimer:function(){if(FlakeExport.previewResizeTimerId!=null){window.clearInterval(FlakeExport.previewResizeTimerId);FlakeExport.previewResizeTimerId=null}},clearCenterDialogTimer:function(){if(FlakeExport.centerDialogTimerId!=null){window.clearTimeout(FlakeExport.centerDialogTimerId);FlakeExport.centerDialogTimerId=null}},getPreviewHeight:function(){var A=0;try{A=FlakeExport.previewFrame.contentWindow.document.body.offsetHeight}catch(B){}if(A>0){if(ie){A=(A-5)}else{A=(A-2)}}return A},update:function(){FlakeExport.previewFrame.style.width=FlakeExport.widthTextBox.value+"px";FlakeExport.previewFrame.style.height=FlakeExport.heightTextBox.value+"px";if(FlakeExport.borderSolidRadioButton.checked){FlakeExport.previewFrame.style.border="solid 3px #cccccc"}else{FlakeExport.previewFrame.style.border="none 0px #cccccc"}FlakeExport.codeTextBox.value=FlakeExport.getGenerateHtml()},isValid:function(){FlakeExport.widthErrorSpan.title="";FlakeExport.heightErrorSpan.title="";$hide(FlakeExport.widthErrorSpan);$hide(FlakeExport.heightErrorSpan);var A=true;if(FlakeExport.widthTextBox.value.length==0){FlakeExport.widthErrorSpan.title="Width cannot be empty.";$visible(FlakeExport.widthErrorSpan);A=false}else{if(!FlakeExport.isPositiveNumeric(FlakeExport.widthTextBox.value)){FlakeExport.widthErrorSpan.title="Width must be a positive numeric value.";$visible(FlakeExport.widthErrorSpan);A=false}}if(FlakeExport.heightTextBox.value.length==0){FlakeExport.heightErrorSpan.title="Height cannot be empty.";$visible(FlakeExport.heightErrorSpan);A=false}else{if(!FlakeExport.isPositiveNumeric(FlakeExport.heightTextBox.value)){FlakeExport.heightErrorSpan.title="Height must be a positive numeric value.";$visible(FlakeExport.heightErrorSpan);A=false}}return A},isPositiveNumeric:function(B){if(B==null){return false}var A=parseInt(B);if(!isNaN(A)){if(A>0){return true}}return false}};window.setTimeout(FlakeExport.init,100);